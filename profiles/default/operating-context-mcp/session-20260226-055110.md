# OperatingContextMcp Session Log

- Timestamp: 2026-02-26 05:51:10 (local)
- Source repo: operating-context-mcp
- Branch: phase-2-mcp-handshake
- Trigger: follow-up optimization request + `log it`

## Change implemented

### Allocation-free chunk append for frame read buffer
- File: `src/OperatingContextMcp.Server/Worker.cs`
- Replaced `readBuffer.AddRange(chunk.AsSpan(0, read).ToArray())` calls with `AppendChunk(readBuffer, chunk, read)`.
- Added `AppendChunk(List<byte> buffer, byte[] chunk, int byteCount)` helper using:
  - `CollectionsMarshal.SetCount(...)` to grow list in-place
  - span copy into the newly added slice
- Applied in both chunk-append sites inside `ReadMessageAsync`.

## Why this matters
- Eliminates temporary array allocation on each read append.
- Keeps frame parsing behavior unchanged while reducing GC pressure in the hot I/O path.

## Validation
- File diagnostics check for `Worker.cs`: no errors found.
- Command: `dotnet build src/OperatingContextMcp.sln`
- Result: succeeded.

## Status snapshot
- This extends the earlier AddRange micro-optimization with allocation-free appends.
